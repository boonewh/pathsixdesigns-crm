Instructions for Other CRM Versions
Fix 1: Forgot Password Page (Frontend)
Problem: The forgot password page calls /api/forgot-password directly instead of using the API base URL, causing 405 errors in production.

File: frontend/src/pages/ForgotPasswordPage.tsx

Change:

Import API_BASE at the top:


import { API_BASE } from "../lib/api";
Replace the hardcoded fetch URL:


// BEFORE
const res = await fetch("/api/forgot-password", {

// AFTER
const res = await fetch(`${API_BASE}/forgot-password`, {
Add error handling for network failures and safe JSON parsing.

Fix 2: Set FRONTEND_URL on Fly.io
Problem: Password reset emails contain localhost:5173 links instead of production URL.

Command:


fly secrets set FRONTEND_URL=https://YOUR-FRONTEND-URL.vercel.app -a YOUR-BACKEND-APP-NAME
Feature: Admin Set Temporary Password
Backend (backend/app/routes/users.py)
Add this endpoint after the update_user_email function:


@users_bp.route("/<int:user_id>/set-password", methods=["PUT"])
@requires_auth(roles=["admin"])
async def set_user_password(user_id):
    """Admin endpoint to set a temporary password for a user."""
    user = request.user
    data = await request.get_json()
    session = SessionLocal()
    try:
        target = session.query(User).filter(
            User.id == user_id,
            User.tenant_id == user.tenant_id
        ).first()

        if not target:
            return jsonify({"error": "User not found"}), 404

        new_password = data.get("password")
        if not new_password:
            return jsonify({"error": "Password is required"}), 400

        if len(new_password) < 6:
            return jsonify({"error": "Password must be at least 6 characters"}), 400

        target.password_hash = hash_password(new_password)
        session.commit()

        return jsonify({
            "message": "Password updated successfully",
            "user_id": target.id,
            "email": target.email
        })

    finally:
        session.close()
Frontend (frontend/src/pages/AdminUsersPage.tsx)
Add state variables (near other useState declarations):


const [settingPasswordUserId, setSettingPasswordUserId] = useState<number | null>(null);
const [tempPassword, setTempPassword] = useState<string>("");
Add handler function (after handleSaveEmail):


const handleSetPassword = async (id: number) => {
  if (tempPassword.length < 6) {
    alert("Password must be at least 6 characters");
    return;
  }

  const res = await apiFetch(`/users/${id}/set-password`, {
    method: "PUT",
    headers: {
      Authorization: `Bearer ${token}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ password: tempPassword }),
  });

  if (res.ok) {
    alert("Temporary password set successfully. User can now log in with this password.");
    setSettingPasswordUserId(null);
    setTempPassword("");
    setOpenMenuId(null);
  } else {
    const { error } = await res.json();
    alert(error || "Failed to set password");
  }
};
Add password input (below the email display/edit section in the user card):


{settingPasswordUserId === user.id && (
  <div className="mt-2">
    <input
      type="text"
      placeholder="Enter temporary password (min 6 chars)"
      value={tempPassword}
      onChange={(e) => setTempPassword(e.target.value)}
      className="border px-2 py-1 rounded w-full text-sm"
    />
    <button
      onClick={() => {
        setSettingPasswordUserId(null);
        setTempPassword("");
      }}
      className="text-xs text-gray-500 hover:text-gray-700 mt-1"
    >
      Cancel
    </button>
  </div>
)}
Add menu option (in the dropdown menu, after Edit Email):


{settingPasswordUserId === user.id ? (
  <button
    onClick={() => handleSetPassword(user.id)}
    className="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 text-green-600"
  >
    Save Password
  </button>
) : (
  <button
    onClick={() => {
      setSettingPasswordUserId(user.id);
      setTempPassword("");
    }}
    className="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 text-orange-600"
  >
    Set Password
  </button>
)}
Deployment
Change	Deploy To
ForgotPasswordPage fix	Vercel (frontend)
FRONTEND_URL env var	Fly.io (just set secret)
Admin set password feature	Both Vercel + Fly.io
No database migrations needed.